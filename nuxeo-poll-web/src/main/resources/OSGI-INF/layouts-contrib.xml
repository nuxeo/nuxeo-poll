<?xml version="1.0" encoding="UTF-8"?>
<component name="org.nuxeo.ecm.poll.layouts">

  <extension target="org.nuxeo.ecm.platform.forms.layout.WebLayoutManager"
    point="widgets">

    <widget name="poll_question" type="text">
      <labels>
        <label mode="any">label.poll.question</label>
      </labels>
      <translated>true</translated>
      <fields>
        <field>dc:title</field>
      </fields>
      <properties widgetMode="edit">
        <property name="styleClass">dataInputText</property>
        <property name="required">true</property>
      </properties>
    </widget>

    <widget name="poll_answers" type="list">
      <labels>
        <label mode="any">label.poll.answers</label>
      </labels>
      <translated>true</translated>
      <fields>
        <field>poll:answers</field>
      </fields>
      <properties widgetMode="edit">
        <property name="required">true</property>
      </properties>
      <subWidgets>
        <widget name="listItem" type="text">
          <fields>
            <field></field>
          </fields>
          <labels>
            <label mode="any"></label>
          </labels>
          <properties widgetMode="edit">
            <property name="required">true</property>
          </properties>
        </widget>
      </subWidgets>
    </widget>

    <widget name="start_date" type="datetime">
      <labels>
        <label mode="any">label.poll.startDate</label>
      </labels>
      <translated>true</translated>
      <fields>
        <field>poll:start_date</field>
      </fields>
      <properties widgetMode="any">
        <property name="pattern">#{nxu:basicDateFormater()}</property>
      </properties>
      <properties widgetMode="edit">
        <property name="format">#{nxu:basicDateFormater()}</property>
      </properties>
    </widget>

    <widget name="end_date" type="datetime">
      <labels>
        <label mode="any">label.poll.endDate</label>
      </labels>
      <translated>true</translated>
      <fields>
        <field>dc:expired</field>
      </fields>
      <properties widgetMode="any">
        <property name="pattern">#{nxu:basicDateFormater()}</property>
      </properties>
      <properties widgetMode="edit">
        <property name="format">#{nxu:basicDateFormater()}</property>
      </properties>
    </widget>

    <widget name="summary_open_poll" type="template">
      <labels>
        <label mode="any">label.summary.poll.status</label>
      </labels>
      <translated>true</translated>
      <properties widgetMode="any">
        <property name="template">
          /widgets/open_poll_widget_template.xhtml
        </property>
      </properties>
      <controls mode="any">
        <control name="handleLabels">true</control>
        <control name="requireSurroundingForm">true</control>
      </controls>
    </widget>

    <widget name="summary_poll_result" type="template">
      <labels>
        <label mode="any"></label>
      </labels>
      <translated>false</translated>
      <properties widgetMode="any">
        <property name="template">
          /widgets/poll_result_widget_template.xhtml
        </property>
      </properties>
      <widgetModes>
        <mode value="view">#{pollActions.displayResults(currentDocument) ? 'view' : 'hidden'}</mode>
      </widgetModes>
    </widget>

    <widget name="summary_back_to_polls_listing" type="template">
      <labels>
        <label mode="any"></label>
      </labels>
      <translated>false</translated>
      <properties widgetMode="any">
        <property name="template">
          /widgets/back_to_polls_listing_widget_template.xhtml
        </property>
      </properties>
      <controls mode="any">
        <control name="requireSurroundingForm">true</control>
      </controls>
    </widget>

  </extension>

  <extension target="org.nuxeo.ecm.platform.actions.ActionService"
    point="actions">

    <action id="summary_current_document_dublincore">
      <filter-id>isNotPoll</filter-id>
    </action>
    <action id="summary_current_document_comments">
      <filter-id>isNotPoll</filter-id>
    </action>
    <action id="summary_current_document_publications">
      <filter-id>isNotPoll</filter-id>
    </action>
    <action id="summary_current_document_single_tasks">
      <filter-id>isNotPoll</filter-id>
    </action>
    <action id="summary_current_document_indicators">
      <filter-id>isNotPoll</filter-id>
    </action>
    <action id="summary_current_document_states">
      <filter-id>isNotPoll</filter-id>
    </action>
    <action id="summary_document_route">
      <filter-id>isNotPoll</filter-id>
    </action>

    <action id="summary_poll_result" type="widget" order="200">
      <category>SUMMARY_PANEL_LEFT</category>
      <properties>
        <property name="widgetName">summary_poll_result</property>
      </properties>
      <filter-id>isPoll</filter-id>
    </action>

    <action id="summary_open_poll" type="widget" order="200">
      <category>SUMMARY_PANEL_RIGHT</category>
      <properties>
        <property name="widgetName">summary_open_poll</property>
      </properties>
      <filter-id>isPoll</filter-id>
    </action>

    <action id="summary_back_to_polls_listing" type="widget" order="50">
      <category>SUMMARY_PANEL_RIGHT</category>
      <properties>
        <property name="widgetName">summary_back_to_polls_listing</property>
      </properties>
      <filter-id>isPoll</filter-id>
    </action>

  </extension>

  <extension target="org.nuxeo.ecm.platform.actions.ActionService"
    point="filters">

    <filter id="isPoll">
      <rule grant="true">
        <type>Poll</type>
      </rule>
    </filter>

    <filter id="isNotPoll">
      <rule grant="false">
        <type>Poll</type>
      </rule>
    </filter>

  </extension>

  <extension target="org.nuxeo.ecm.platform.forms.layout.WebLayoutManager"
    point="layouts">

    <layout name="poll_heading">
      <templates>
        <template mode="any">/layouts/layout_default_template.xhtml</template>
      </templates>
      <rows>
        <row>
          <widget>poll_question</widget>
        </row>
        <row>
          <widget>description</widget>
        </row>
      </rows>
    </layout>

    <layout name="poll">
      <templates>
        <template mode="any">/layouts/layout_default_template.xhtml</template>
      </templates>
      <rows>
        <row>
          <widget>poll_answers</widget>
        </row>
        <row>
          <widget>start_date</widget>
        </row>
        <row>
          <widget>end_date</widget>
        </row>
      </rows>
    </layout>

    <layout name="poll_dublincore">
      <templates>
        <template mode="any">/layouts/layout_default_template.xhtml</template>
      </templates>
      <rows>
        <row>
          <widget>subjects</widget>
        </row>
        <row>
          <widget>created</widget>
        </row>
        <row>
          <widget>modified</widget>
        </row>
        <row>
          <widget>author</widget>
        </row>
        <row>
          <widget>contributors</widget>
        </row>
        <row>
          <widget>lastContributor</widget>
        </row>
      </rows>
    </layout>

    <!-- deprecated since 5.7.1, here for compat -->
    <layout name="poll_summary_layout">
      <templates>
        <template mode="any">/layouts/layout_summary_template.xhtml</template>
      </templates>
      <rows>
        <row>
        </row>
        <row>
          <widget>summary_current_document_description</widget>
          <widget>summary_poll_result</widget>
        </row>
        <row>
          <widget>summary_back_to_polls_listing</widget>
          <widget>summary_open_poll</widget>
          <widget>summary_current_document_actions</widget>
          <widget>summary_current_document_view</widget>
          <widget>summary_current_document_tagging</widget>
        </row>
      </rows>
    </layout>

  </extension>

</component>
